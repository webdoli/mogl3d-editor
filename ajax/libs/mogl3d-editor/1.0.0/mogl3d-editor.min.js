!function(e,t){"function"==typeof define&&define.amd?define([],(function(){return t()})):"object"==typeof module&&module.exports?module.exports=t():e.MOGL3D=t()}("undefined"!=typeof self?self:this,(function(){"use strict";function e(e,t={}){if(this.addFonts(),this.name="MOGL3D Library",this.loader=null,this.modules=null,this.element=e,this.options=t,this.threeSceneNum=0,this.uploadModels=[],this.options.plugins&&this.options.plugins.length>0){let e=this;this.options.plugins.map((t=>{for(let o in t)"threeModules"===o&&(e.modules=t[o])}))}this.actions=t.actions?t.actions.map((e=>"string"==typeof e?this.defaultActions()[e]:this.defaultActions()[e.name]?{...this.defaultActions()[e.name],...e}:e)):Object.keys(this.defaultActions()).map((e=>this.defaultActions()[e])),this.classes={...this.defaultClasses(),...this.options.classes},this.formatBlock="formatBlock",this.defaultParagraphSeparatorString="defaultParagraphSeparator",this.init(),this.initDropdownMenu()}return e.prototype.dropdownActions=function(){return{fontColor:{icon:'<img src="./css/icons/icons-type-color.png" class="mogl3d-icons-type">',result:()=>this.createColorInput("color","foreColor","Menu-dropdown"),title:"Font Color"},fontType:{icon:'\n                    <label for="fontfamily">font family:</label>\n                    <select id="mogl3d-fontfamily">\n                    <option data-type="placeholder" selected> </option>\n                        <option value=\'"Noto Sans KR", sans-serif\'>Nano</option>\n                        <option value=\'"Roboto", sans-serif\'>Roboto</option>\n                        <option value=\'"Poetsen One"\'>Poetsen</option>\n                        <option value=\'"Ubuntu Sans", sans-serif\'>Ubuntu</option>\n                        <option value=\'"Open Sans", sans-serif\'>Open Sans</option>\n                        <option value=\'"Sedan SC", serif\'>Sedan SC</option>\n                        <option value=\'"Lato", sans-serif\'>Lato</option>\n                        <option value=\'"Nanum Myeongjo", serif\'>Nanum Myeongjo</option>\n                        <option value=\'"Noto Serif KR", serif\'>Noto</option>\n                        <option value=\'"Black Han Sans", sans-serif\'>Black Han Sans</option>\n                        <option value=\'"Lora", serif\'>Lora</option>\n                        <option value=\'"Nanum Gothic", sans-serif\'>Nanum Gothic</option>\n                    </select>\n                ',result:()=>{this.initFontTypeListener()},title:"Font Color"},fontSize:{icon:'\n                    <label for="fontsize">size:</label>\n                    <select id="mogl3d-fontsize">\n                        <option data-type="placeholder" selected> </option>\n                        <option value="12px">Small</option>\n                        <option value="16px">Medium</option>\n                        <option value="20px">Large</option>\n                        <option value="24px">Extra Large</option>\n                    </select>\n                ',result:()=>{this.initFontSizeListener()},title:"Font Color"},highlight:{icon:'<img src="./css/icons/icons-type-bg.png" class="mogl3d-icons-type">',result:()=>this.createColorInput("color","backColor","Menu-dropdown"),title:"Highlight Text"},removeHighlight:{icon:'<img src="./css/icons/icons-type-erase.png" class="mogl3d-icons-type">',result:()=>{this.exec("backColor","transparent"),this.closeDropDown("Menu-dropdown")},title:"Remove Highlight"},leftAlign:{icon:"&#x21E4;",result:()=>{this.exec("justifyLeft"),this.closeDropDown("Menu-dropdown")},title:"LeftAlign"},rightAlign:{icon:"&#x21E5;",result:()=>{this.exec("justifyRight"),this.closeDropDown("Menu-dropdown")},title:"RightAlign"},centerAlign:{icon:"&#x21C5;",result:()=>{this.exec("justifyCenter"),this.closeDropDown("Menu-dropdown")},title:"CenterAlign"},image:{icon:'<img src="./css/icons/icons-image-file-add.png" class="mogl3d-icons-type">',result:()=>{this.createIMGFileBox("image/*"),this.closeDropDown("Menu-dropdown")},title:"Image"},files:{icon:'<img src="./css/icons/icons-zip.png" class="mogl3d-icons-type">',result:()=>{this.createZipFile(),this.closeDropDown("Menu-dropdown")},title:"files"},video:{icon:'<img src="./css/icons/icons-video-upload_.png" class="mogl3d-icons-type">',result:()=>this.createModal("video"),title:"Video"},load3DModel:{icon:'<img src="./css/icons/icons-3d_.png" class="mogl3d-icons-type">',result:()=>this.threeDFileLoader(),title:"Load 3D Model"}}},e.prototype.defaultActions=function(){return{italic:{icon:"<i>I</i>",result:()=>this.exec("italic"),state:()=>this.queryCommandState("italic"),title:"Italic"},bold:{icon:"<b>B</b>",result:()=>this.exec("bold"),state:()=>this.queryCommandState("bold"),title:"Bold"},underline:{icon:"<u>U</u>",result:()=>this.exec("underline"),state:()=>this.queryCommandState("underline"),title:"Underline"},strikethrough:{icon:"<strike>S</strike>",result:()=>this.exec("strikeThrough"),state:()=>this.queryCommandState("strikeThrough"),title:"Strike-through"},fontMenu:{icon:'<img src="./css/icons/icons-font_menus.png" class="mogl3d-icons font-menu">',result:()=>{},init:e=>{this.initMenu(e,"mogl3d-content",[this.dropdownActions().fontType,this.dropdownActions().fontSize],"FontMenu-dropdown")},title:"FontDropDown"},textColorMenu:{icon:'<img src="./css/icons/icons-type-Menus.png" class="mogl3d-icons">',result:()=>{},init:e=>{this.initMenu(e,"mogl3d-content",[this.dropdownActions().fontColor,this.dropdownActions().highlight,this.dropdownActions().removeHighlight],"TextMenu-dropdown")},title:"TextColorDropDown"},alignMenu:{icon:"Ξ",result:()=>{},init:e=>{this.initMenu(e,"mogl3d-content",[this.dropdownActions().leftAlign,this.dropdownActions().rightAlign,this.dropdownActions().centerAlign],"AlignMenu-dropdown")},title:"TextAlignDropDown"},line:{icon:"&#8213;",result:()=>this.exec("insertHorizontalRule"),divider:!0,title:"Horizontal Line"},olist:{icon:"&#35;",result:()=>this.exec("insertOrderedList"),title:"Ordered List"},quote:{icon:"&#8220; &#8221;",result:()=>this.exec(this.formatBlock,"<blockquote>"),title:"Quote"},ulist:{icon:"&#8226;",result:()=>this.exec("insertUnorderedList"),title:"Unordered List"},filesMenu:{icon:'<img src="./css/icons/icons-upload_menus_.png" class="mogl3d-icons">',result:()=>{},init:e=>{this.initMenu(e,"mogl3d-content",[this.dropdownActions().image,this.dropdownActions().files,this.dropdownActions().video,this.dropdownActions().load3DModel],"FileMenu-dropdown")},title:"FilesDropDown"}}},e.prototype.init=function(){const e=this,t=document.createElement("div");t.className=this.classes.actionbar,this.element.appendChild(t);const o=document.createElement("div");o.contentEditable=!0,o.className=this.classes.content;this.options[this.defaultParagraphSeparatorString];this.element.appendChild(o),this.actions.forEach((n=>{const i=document.createElement("button");if(i.className=e.classes.button,i.innerHTML=n.icon,i.setAttribute("type","button"),i.title=n.title,i.addEventListener("click",(e=>{n.result(),o.focus()})),n.state){const t=()=>i.classList[n.state()?"add":"remove"](e.classes.selected);o.addEventListener("keyup",t),o.addEventListener("mouseup",t),i.addEventListener("click",t)}t.appendChild(i)})),this.actions.forEach((e=>{if(e.init){const t=document.querySelector(`button[title="${e.title}"]`);t&&e.init(t)}}))},e.prototype.defaultClasses=function(){return{actionbar:"mogl3d-actionbar",button:"mogl3d-button",content:"mogl3d-content",selected:"mogl3d-button-selected"}},e.prototype.exec=function(e,t=null){document.execCommand(e,!1,t)},e.prototype.queryCommandState=function(e){return document.queryCommandState(e)},e.prototype.queryCommandValue=function(e){return document.queryCommandValue(e)},e.prototype.closeDropDown=function(e){document.querySelectorAll(`.${e}`).forEach((e=>{e.style.display="none"}))},e.prototype.createColorInput=function(e,t,o){const n=document.createElement("input"),i=this;n.type=e,n.oninput=e=>{i.exec(t,e.target.value),n.remove()},n.click(),this.closeDropDown(o)},e.prototype.initDropdownMenu=function(){let e=document.querySelectorAll(".dropdown"),t=["TextMenu-dropdown","AlignMenu-dropdown","FileMenu-dropdown","FontMenu-dropdown"];e.forEach((e=>{document.querySelector("#editor");e.addEventListener("click",(async e=>{let o=e.target.parentNode,n="BUTTON"===o.nodeName?o.parentNode:o,i=await this.chkDropID(n);t.forEach((e=>{let t=document.querySelector(`#${e}`);t&&e!==i&&(t.style.display="none")}));let l=document.querySelector(`#${i}`);"flex"===l.style.display?l.style.display="none":l.style.display="flex",e.stopPropagation()}))})),document.addEventListener("click",(e=>{document.querySelector(".mogl3d-content");let o=e.target;"mogl3d-fontsize"!==o.id&&"mogl3d-fontfamily"!==o.id&&t.map((e=>{let t=document.querySelector(`#${e}`);t&&"flex"===t.style.display&&(t.style.display="none")}))}))},e.prototype.initMenu=function(e,t,o,n){let i=document.querySelector(`.${t}`),l=this.createDropDownMenu(e,o,i,n);e.parentNode.replaceChild(l,e)},e.prototype.createDropDownMenu=function(e,t,o,n){const i=document.createElement("div");i.className="dropdown";const l=e.cloneNode(!0),s=document.createElement("div");return s.id=n,s.className="Menu-dropdown",Array.from(t).forEach((e=>{const t=document.createElement("button");t.className="mogl3d-button",t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&o.focus(),s.appendChild(t)})),i.appendChild(l),i.appendChild(s),i},e.prototype.threeDFileLoader=function(){const e=document.createElement("input");e.type="file",e.multiple=!0,e.onchange=async e=>{const t=e.target.files;try{let e=null,o=new this.modules({editor:this.element});o.loadFiles(t,e,(e=>{const t=this.saveCurrentRange();t?this.insert3DModelAtLine(o,e,t):this.insert3DModelAtLine(o,e)}))}catch(e){console.error("File Loading Error:",e)}},e.click(),this.closeDropDown("Menu-dropdown")},e.prototype.saveCurrentRange=function(){return window.getSelection().rangeCount>0?window.getSelection().getRangeAt(0):null},e.prototype.getModels=function(){if(this.uploadModels.length>0)return this.uploadModels},e.prototype.insert3DModelAtLine=function(e,t,o){this.threeSceneNum++;this.element;const n=window.getSelection();let i=document.createElement("div");i.style.display="inline-block";let l=document.createElement("span");l.textContent=" ";let s=document.createElement("span");s.textContent=" ";let r=document.createElement("div");r.title=`threeSceneNum${this.threeSceneNum}`,r.className="three-scene",this.uploadModels.push({[r.title]:t});let d=e.init(r,t);i.appendChild(l),i.appendChild(d),i.appendChild(s);const c=document.createElement("div");c.textContent=" ";const a=document.createElement("div");a.appendChild(c),a.appendChild(i);const p=document.createElement("div");if(p.textContent=" ",a.appendChild(p),o){o.deleteContents(),o.insertNode(a);let e=document.createRange();e.setStartAfter(p),e.collapse(!0),window.getSelection().removeAllRanges(),window.getSelection().addRange(e)}else{const e=document.querySelector(".mogl3d-content"),t=document.createRange();t.selectNodeContents(c),t.collapse(!0),n.removeAllRanges(),n.addRange(t),e.appendChild(a)}},e.prototype.createIMGFileBox=function(e){const t=document.createElement("input");return t.type="file",t.accept=e,t.onchange=e=>{const o=e.target.files[0];if(o){const e=new FileReader;e.onload=e=>{const t=document.createElement("img");t.src=e.target.result;const o=document.getSelection();let n;if(o.rangeCount>0)n=o.getRangeAt(0),n.deleteContents(),n.insertNode(t);else{const e=document.querySelector(".mogl3d-content");e.insertBefore(t,e.firstChild)}},e.readAsDataURL(o)}t.remove()},t.click(),t},e.prototype.createZipFile=function(){const e=document.createElement("input");return e.type="file",e.accept=".zip",e.onchange=t=>{const o=t.target.files[0];if(o){const t=document.createElement("div");t.contentEditable=!1,t.style.display="inline-block",t.style.margin="5px";const n=document.createElement("span");n.textContent=o.name+" ",t.appendChild(n);const i=document.createElement("button");i.textContent="x",i.style.marginLeft="5px",i.onclick=()=>{t.remove()},t.appendChild(i);const l=document.getSelection();let s;if(l.rangeCount>0)s=l.getRangeAt(0),s.deleteContents(),s.insertNode(t);else{const e=document.querySelector(".mogl3d-content");e.insertBefore(t,e.firstChild)}e.remove()}},e.click(),e},e.prototype.createModal=function(e){let t;window.getSelection().rangeCount>0&&(t=window.getSelection().getRangeAt(0)),this.closeDropDown("Menu-dropdown");const o=document.createElement("div");o.setAttribute("class","modal"),o.id="videoModal";const n=document.createElement("div");n.setAttribute("class","modal-content"),o.appendChild(n);const i=document.createElement("span");if(i.setAttribute("class","modalClose"),i.id="videoModalClose",i.textContent="×",i.addEventListener("click",(e=>{if(this.closeModal(o),t){const e=window.getSelection();e.removeAllRanges(),e.addRange(t)}})),n.appendChild(i),"video"===e){let e=this.videoForm(n,o,t);o.appendChild(e)}return document.body.appendChild(o),o.style.display="block",o.addEventListener("mousedown",(function(e){e.stopPropagation()}),!0),o},e.prototype.videoForm=function(e,t,o){const n=document.createElement("h2");n.textContent="Add Video";const i=document.createElement("input");i.type="text",i.id="videoUrlInput",i.placeholder="Enter video URL";const l=document.createElement("input");l.type="file",l.id="videoFileInput",l.accept="video/*";const s=document.createElement("button");return s.textContent="Insert Video",s.addEventListener("click",(e=>this.insertVideoFromModal(t,o))),e.appendChild(n),e.appendChild(i),e.appendChild(l),e.appendChild(s),e},e.prototype.closeModal=function(e){e.style.display="none",e.remove()},e.prototype.insertVideoFromModal=function(e,t){const o=this,n=document.getElementById("videoUrlInput").value,i=document.getElementById("videoFileInput").files[0];n?o.insertVideoIframe(n,t):i&&i.size<=31457280?o.insertVideoFile(i):i&&alert("File is too large. Maximum size is 30MB."),this.closeModal(e)},e.prototype.convertToEmbedUrl=function(e){let t=e;if(e.includes("youtube.com/watch?v=")){t=`https://www.youtube-nocookie.com/embed/${e.split("v=")[1].split("&")[0]}`}else if(e.includes("youtu.be/")){t=`https://www.youtube-nocookie.com/embed/${e.split("youtu.be/")[1]}`}return t},e.prototype.insertVideoIframe=function(e,t){let o=this.convertToEmbedUrl(e);const n=document.querySelector(".mogl3d-content");let i=document.createTextNode("");const l=document.createElement("span");l.innerHTML=" ",l.appendChild(i);const s=document.createElement("iframe");s.src=o,s.style.width="560px",s.style.height="315px",s.frameBorder="0",s.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",s.allowFullscreen=!0,l.appendChild(s),l.style.whiteSpace="pre",t?(t.deleteContents(),t.insertNode(l)):n.insertBefore(l,n.firstChild)},e.prototype.insertVideoFile=function(e){const t=document.querySelector(".mogl3d-content");let o=document.createTextNode("");const n=document.createElement("span");n.innerHTML=" ",n.appendChild(o);const i=document.createElement("video");i.controls=!0;const l=document.createElement("source");l.src=URL.createObjectURL(e),l.type=e.type,i.appendChild(l);const s=document.createElement("p");s.contentEditable=!0,s.innerHTML="<br>",n.appendChild(i),n.style.whiteSpace="pre";const r=document.getSelection();let d;return r.rangeCount>0?(d=r.getRangeAt(0),d.deleteContents(),d.insertNode(n)):t.insertBefore(n,t.firstChild),t},e.prototype.chkDropID=function(e){return new Promise((t=>{for(let o=0;o<e.childNodes.length;o++)""!==e.childNodes[o].id&&t(e.childNodes[o].id)}))},e.prototype.addFonts=function(){var e=document.createElement("link");e.rel="preconnect",e.href="https://fonts.googleapis.com",document.head.appendChild(e);var t=document.createElement("link");t.rel="preconnect",t.href="https://fonts.gstatic.com",t.crossOrigin="anonymous",document.head.appendChild(t);var o=document.createElement("link");o.rel="stylesheet",o.href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Lora:ital,wght@0,400..700;1,400..700&family=Nanum+Gothic&family=Nanum+Myeongjo&family=Noto+Sans+KR:wght@100..900&family=Noto+Serif+KR&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poetsen+One&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Sedan+SC&family=Ubuntu+Sans:ital,wght@0,100..800;1,100..800&display=swap",document.head.appendChild(o)},e.prototype.initFontTypeListener=function(){const e=document.getElementById("mogl3d-fontfamily");e&&(e.removeEventListener("change",this.handleFontTypeChange),this.handleFontTypeChange=t=>{const o=e.value,n=window.getSelection();n.rangeCount&&this.wrapTextWithSpan(n,"fontFamily",o,"font-family")},e.addEventListener("change",this.handleFontTypeChange))},e.prototype.initFontSizeListener=function(){const e=document.getElementById("mogl3d-fontsize");e&&(e.removeEventListener("change",this.handleFontSizeChange),this.handleFontSizeChange=t=>{const o=e.value,n=window.getSelection();n.rangeCount&&this.wrapTextWithSpan(n,"fontSize",o,"font-size")},e.addEventListener("change",this.handleFontSizeChange))},e.prototype.wrapTextWithSpan=function(e,t,o,n){let i=e.getRangeAt(0);const l=e.toString().split("\n").length>1;if(!l){let e=i.extractContents(),l=i.commonAncestorContainer,s=this.findParentNode(l,"DIV");"font-size"===n?this.removeChildNode(e,"span","mogl3d-font-span"):this.removeChildNode(e,"span","mogl3d-fontfamily-span");let r=document.createElement("span");r.style[t]=o,r.className="font-size"===n?"mogl3d-font-span":"mogl3d-fontfamily-span",r.appendChild(e),r.normalize(),i.insertNode(r),this.removeEmptyNodes(s)}if(l){let l=i.cloneContents(),s=i.startContainer,r=i.endContainer,d=this.findParentNode(s,"DIV"),c=this.findParentNode(r,"DIV"),a=d.parentNode;i.deleteContents();let p=document.createRange();this.removeEmptyNodes(d),this.removeEmptyNodes(c);let u=l.firstChild,m=l.lastChild;"font-size"===n?(this.removeChildNode(u,"span","mogl3d-font-span"),this.removeChildNode(m,"span","mogl3d-font-span")):"font-family"===n&&(this.removeChildNode(u,"span","mogl3d-fontfamily-span"),this.removeChildNode(m,"span","mogl3d-fontfamily-span"));let h=document.createElement("span");h.className="font-size"===n?"mogl3d-font-span":"mogl3d-fontfamily-span",h.style[t]=o;let f=[],g=l.cloneNode(!0),y=g.childNodes.length-1;Array.from(g.childNodes).forEach(((e,i)=>{if(0!==i&&i!==y){this.removeEmptyNodes(e),"font-size"===n?this.removeChildNode(e,"span","mogl3d-font-span"):this.removeChildNode(e,"span","mogl3d-fontfamily-span");let i=document.createElement("span");i.className="font-size"===n?"mogl3d-font-span":"mogl3d-fontfamily-span",i.style[t]=o;let l=this.changeNodeToNode(e,i),s=document.createElement("div");s.appendChild(l),f.push(s)}}));let C=document.createElement("span");C.className="font-size"===n?"mogl3d-font-span":"mogl3d-fontfamily-span",C.style[t]=o;let N=this.changeNodeToNode(u,h),E=this.changeNodeToNode(m,C);N.normalize(),E.normalize(),d.appendChild(N),c.insertBefore(E,c.firstChild),f.map((e=>{e.normalize(),a.insertBefore(e,c)})),p.setStartBefore(N),p.setEndAfter(E),e.removeAllRanges(),e.addRange(p)}},e.prototype.removeEmptyNodes=function(e){if(e)for(let t=0;t<e.childNodes.length;t++){const o=e.childNodes[t];this.removeEmptyNodes(o),(o.nodeType===Node.ELEMENT_NODE&&""===o.innerHTML||o.nodeType===Node.TEXT_NODE&&""===o.textContent.trim())&&(e.removeChild(o),t--)}},e.prototype.changeNodeToNode=function(e,t){let o=e.cloneNode(!0);for(;o.firstChild;)t.appendChild(o.firstChild);return t},e.prototype.findChildIndex=function(e,t){return Array.prototype.slice.call(e.childNodes).indexOf(t)},e.prototype.extractText=function(e){let t="";return e.nodeType===Node.TEXT_NODE?t+=e.nodeValue:e.nodeType===Node.ELEMENT_NODE&&e.childNodes.forEach((e=>{t+=this.extractText(e)})),t},e.prototype.findParentNode=function(e,t){for(;null!==e&&e.tagName!==t;)e=e.parentNode;return e},e.prototype.removeChildNode=function(e,t,o){let n=o||null;e.querySelectorAll(t).forEach((e=>{if(e.className===n){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}}))},e.prototype.removeNullNode=function(e){Array.from(e.childNodes).forEach((t=>{this.removeNullNode(t),this.isNodeEmpty(t)&&e.removeChild(t)}))},e.prototype.isNodeEmpty=function(e){return e.nodeType===Node.ELEMENT_NODE?0===e.childNodes.length||this.areAllChildrenEmpty(e):e.nodeType===Node.TEXT_NODE&&!e.textContent.trim()},e.prototype.areAllChildrenEmpty=function(e){for(let t=0;t<e.childNodes.length;t++)if(!this.isNodeEmpty(e.childNodes[t]))return!1;return!0},e.prototype.removeUpToTagName=function(e,t){let o;for(;e.parentNode&&e.parentNode.nodeName!==t.toUpperCase();)e=e.parentNode;return e.parentNode&&e.parentNode.nodeName===t.toUpperCase()&&(o=e.parentNode,e.parentNode.removeChild(e)),o},e.prototype.removeParentNode=function(e,t){for(;null!==e&&e.tagName!==t;)e=e.parentNode;if(e&&e.tagName===t){const t=e.parentNode;for(console.log("parent: ",t);e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}return e},e.prototype.collectNode=function(e,t,o){return e.nodeType===Node.ELEMENT_NODE&&e.tagName===t&&o.push(e),Array.from(e.childNodes).forEach((e=>this.collectNode(e,t,o))),o},e}));