!function(e,t){"function"==typeof define&&define.amd?define([],function(){return t()}):"object"==typeof module&&module.exports?module.exports=t():e.MOGL3D=t()}("undefined"!=typeof self?self:this,function(){"use strict";function e(e={}){if(this.addFonts(),this.name="MOGL3D Library",this.loader=null,this.modules=null,this.element=e.element,this.editorName=e.editorName,this.content=null,this.options=e,this.savedRange=null,this.threeSceneNum=0,this.imgFileNum=0,this.zipFileNum=0,this.filesNum=0,this.sceneModelSum=0,this.uploadFiles=[],this.uploadModels=[],this.zipUploadFiles=[],this.imgUploadFiles=[],this.scenes=[],this.dt=new DataTransfer,this.options.gui&&(this.height=this.options.gui.height?this.options.gui.height:null),this.options.plugins&&this.options.plugins.length>0){let t=this;this.options.plugins.map(e=>{for(let i in e)"threeModules"===i&&(t.modules=e[i])})}this.actions=e.actions?e.actions.map(e=>"string"==typeof e?this.defaultActions()[e]:this.defaultActions()[e.name]?{...this.defaultActions()[e.name],...e}:e):Object.keys(this.defaultActions()).map(e=>this.defaultActions()[e]),this.classes={...this.defaultClasses(this.editorName),...this.options.classes},this.formatBlock="formatBlock",this.defaultParagraphSeparatorString="defaultParagraphSeparator",this.init(),this.initDropdownMenu()}function t(){let e=document.createElement("div");e.className="three-file-file-group";let t=document.createElement("div");t.className="three-file-file-upload";let i=document.createElement("label");i.textContent="3D Model File:";let o=document.createElement("input");o.type="file",o.name="modelFile",o.multiple=!0,o.accept=".obj,.fbx,.gltf,.glb,.bin",t.appendChild(i),t.appendChild(o);let n=document.createElement("div");n.className="three-file-file-upload";let l=document.createElement("label");l.textContent="Texture File:";let s=document.createElement("input");return s.type="file",s.name="textureFile",s.accept=".jpg,.png,.tif,.targa",s.multiple=!0,n.appendChild(l),n.appendChild(s),e.appendChild(t),e.appendChild(n),e}return e.prototype.dropdownActions=function(){return{fontColor:{icon:'<i class="fas fa-highlighter"></i>',result:()=>this.createColorInput("color","foreColor","Menu-dropdown"),title:"Font Color"},fontType:{icon:`
                    <label for="fontfamily">font family:</label>
                    <select id="mogl3d-fontfamily">
                    <option data-type="placeholder" selected> </option>
                        <option value='"Noto Sans KR", sans-serif'>Nano</option>
                        <option value='"Roboto", sans-serif'>Roboto</option>
                        <option value='"Poetsen One"'>Poetsen</option>
                        <option value='"Ubuntu Sans", sans-serif'>Ubuntu</option>
                        <option value='"Open Sans", sans-serif'>Open Sans</option>
                        <option value='"Sedan SC", serif'>Sedan SC</option>
                        <option value='"Lato", sans-serif'>Lato</option>
                        <option value='"Nanum Myeongjo", serif'>Nanum Myeongjo</option>
                        <option value='"Noto Serif KR", serif'>Noto</option>
                        <option value='"Black Han Sans", sans-serif'>Black Han Sans</option>
                        <option value='"Lora", serif'>Lora</option>
                        <option value='"Nanum Gothic", sans-serif'>Nanum Gothic</option>
                    </select>
                `,result:()=>{this.initFontTypeListener()},title:"Font Color"},fontSize:{icon:`
                    <label for="fontsize">size:</label>
                    <select id="mogl3d-fontsize">
                        <option data-type="placeholder" selected> </option>
                        <option value="12px">Small</option>
                        <option value="16px">Medium</option>
                        <option value="20px">Large</option>
                        <option value="24px">Extra Large</option>
                    </select>
                `,result:()=>{this.initFontSizeListener()},title:"Font Color"},highlight:{icon:'<i class="fas fa-fill-drip"></i>',result:()=>this.createColorInput("color","backColor","Menu-dropdown"),title:"Highlight Text"},removeHighlight:{icon:'<i class="fas fa-eraser"></i>',result:()=>{this.exec("backColor","transparent"),this.closeDropDown("Menu-dropdown")},title:"Remove Highlight"},leftAlign:{icon:'<i class="fas fa-align-left"></i>',result:()=>{this.exec("justifyLeft"),this.closeDropDown("Menu-dropdown")},title:"LeftAlign"},rightAlign:{icon:'<i class="fas fa-align-right"></i>',result:()=>{this.exec("justifyRight"),this.closeDropDown("Menu-dropdown")},title:"RightAlign"},centerAlign:{icon:'<i class="fas fa-align-center"></i>',result:()=>{this.exec("justifyCenter"),this.closeDropDown("Menu-dropdown")},title:"CenterAlign"},image:{icon:'<i class="fas fa-file-image"></i>',result:()=>{this.createIMGFileBox("image/*"),this.closeDropDown("Menu-dropdown")},title:"Image"},files:{icon:'<i class="fas fa-file-archive"></i>',result:()=>{this.createZipFile(),this.closeDropDown("Menu-dropdown")},title:"files"},load3DModel:{icon:'<i class="fas fa-cube"></i>',result:()=>this.threeDFileLoader(),title:"Load 3D Model"}}},e.prototype.defaultActions=function(){return{italic:{icon:"<i>I</i>",result:()=>this.exec("italic"),state:()=>this.queryCommandState("italic"),title:"Italic"},bold:{icon:"<b>B</b>",result:()=>this.exec("bold"),state:()=>this.queryCommandState("bold"),title:"Bold"},underline:{icon:"<u>U</u>",result:()=>this.exec("underline"),state:()=>this.queryCommandState("underline"),title:"Underline"},strikethrough:{icon:"<strike>S</strike>",result:()=>this.exec("strikeThrough"),state:()=>this.queryCommandState("strikeThrough"),title:"Strike-through"},fontMenu:{icon:'<i class="fas fa-text-height"></i>',result(){},init:e=>{this.initMenu(e,this.editorName,[this.dropdownActions().fontType,this.dropdownActions().fontSize,],"FontMenu-dropdown")},title:"FontDropDown"},textColorMenu:{icon:'<i class="fas fa-font"></i>',result(){},init:e=>{this.initMenu(e,this.editorName,[this.dropdownActions().fontColor,this.dropdownActions().highlight,this.dropdownActions().removeHighlight],"TextMenu-dropdown")},title:"TextColorDropDown"},alignMenu:{icon:'<i class="fas fa-align-justify"></i>',result(){},init:e=>{this.initMenu(e,this.editorName,[this.dropdownActions().leftAlign,this.dropdownActions().rightAlign,this.dropdownActions().centerAlign],"AlignMenu-dropdown")},title:"TextAlignDropDown"},line:{icon:"&#8213;",result:()=>this.exec("insertHorizontalRule"),divider:!0,title:"Horizontal Line"},olist:{icon:"&#35;",result:()=>this.exec("insertOrderedList"),title:"Ordered List"},quote:{icon:"&#8220; &#8221;",result:()=>this.exec(this.formatBlock,"<blockquote>"),title:"Quote"},ulist:{icon:"&#8226;",result:()=>this.exec("insertUnorderedList"),title:"Unordered List"},filesMenu:{icon:'<i class="fas fa-upload"></i>',result(){},init:e=>{this.initMenu(e,this.editorName,[this.dropdownActions().image,this.dropdownActions().files,this.dropdownActions().load3DModel],"FileMenu-dropdown")},title:"FilesDropDown"}}},e.prototype.init=function(){let e=this,t=document.createElement("div");t.className=this.classes.actionbar,this.element.appendChild(t),t.style.height=this.height?`${this.height}px`:"720px";let i=document.createElement("div");i.contentEditable=!0,i.className=this.classes.content,i.style.height=this.height?`${this.height}px`:"720px";let o=this.options[this.defaultParagraphSeparatorString]||"div";i.oninput=({target:{firstChild:e}})=>{e&&3===e.nodeType?this.exec("formatBlock",`<${o}>`):"<br>"===i.innerHTML&&(i.innerHTML=""),this.options.onChange&&(this.uploadModels?this.options.onChange(i.innerHTML,this.uploadModels):this.options.onChange(i.innerHTML))},i.onkeydown=e=>{"Enter"===e.key&&"blockquote"===this.queryCommandValue("formatBlock")&&setTimeout(()=>this.exec("formatBlock",`<${o}>`),0)},i.addEventListener("keyup",()=>{e.saveSelection()}),i.addEventListener("mouseup",()=>{e.saveSelection()}),i.addEventListener("focus",()=>{e.saveSelection()}),this.element.appendChild(i),this.content=i,this.actions.forEach(o=>{let n=document.createElement("button");if(n.className=e.classes.button,n.innerHTML=o.icon,n.setAttribute("type","button"),n.title=o.title,n.addEventListener("click",e=>{o.result(),i.focus()}),o.state){let l=()=>n.classList[o.state()?"add":"remove"](e.classes.selected);i.addEventListener("keyup",l),i.addEventListener("mouseup",l),n.addEventListener("click",l)}t.appendChild(n)}),this.actions.forEach(e=>{if(e.init){let t=document.querySelector(`button[title="${e.title}"]`);t&&e.init(t)}})},e.prototype.saveSelection=function(){let e=document.getSelection();e.rangeCount>0&&(this.savedRange=e.getRangeAt(0))},e.prototype.defaultClasses=function(e){return{actionbar:"mogl3d-actionbar",button:"mogl3d-button",content:e,selected:"mogl3d-button-selected"}},e.prototype.exec=function(e,t=null){document.execCommand(e,!1,t)},e.prototype.queryCommandState=function(e){return document.queryCommandState(e)},e.prototype.queryCommandValue=function(e){return document.queryCommandValue(e)},e.prototype.closeDropDown=function(e){let t=document.querySelectorAll(`.${e}`);t.forEach(e=>{e.style.display="none"})},e.prototype.createColorInput=function(e,t,i){let o=document.createElement("input"),n=this;o.type=e,o.oninput=e=>{n.exec(t,e.target.value),o.remove()},o.click(),this.closeDropDown(i)},e.prototype.initDropdownMenu=function(){let e=document.querySelectorAll(".dropdown"),t=["TextMenu-dropdown","AlignMenu-dropdown","FileMenu-dropdown","FontMenu-dropdown"];e.forEach(e=>{document.querySelector("#editor"),e.addEventListener("click",async e=>{let i=e.target.parentNode,o=await this.chkDropID("BUTTON"===i.nodeName?i.parentNode:i);t.forEach(e=>{let t=document.querySelector(`#${e}`);t&&e!==o&&(t.style.display="none")});let n=document.querySelector(`#${o}`);"flex"===n.style.display?n.style.display="none":n.style.display="flex",e.stopPropagation()})}),document.addEventListener("click",e=>{document.querySelector(`.${this.editorName}`);let i=e.target;"mogl3d-fontsize"!==i.id&&"mogl3d-fontfamily"!==i.id&&t.map(e=>{let t=document.querySelector(`#${e}`);t&&"flex"===t.style.display&&(t.style.display="none")})})},e.prototype.initMenu=function(e,t,i,o){let n=document.querySelector(`.${t}`),l=this.createDropDownMenu(e,i,n,o);e.parentNode.replaceChild(l,e)},e.prototype.createDropDownMenu=function(e,t,i,o){let n=document.createElement("div");n.className="dropdown";let l=e.cloneNode(!0),s=document.createElement("div");return s.id=o,s.className="Menu-dropdown",Array.from(t).forEach(e=>{let t=document.createElement("button");t.className="mogl3d-button",t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&i.focus(),s.appendChild(t)}),n.appendChild(l),n.appendChild(s),n},e.prototype.resetDT=function(){console.log("reset DT"),this.sceneModelSum=0,this.dt=null,this.dt=new DataTransfer},e.prototype.getDT=function(){return(console.log("get DT"),this.dt)?this.dt:new DataTransfer},e.prototype.removeModal=function(){let e=document.getElementById("modal");e&&e.remove()},e.prototype.containsKoreanOrSpecialChars=function(e){return/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(e)||/[~`!@#$%^&*()_\-+={}[\]|\\:;"'<>,.?/]/.test(e)},e.prototype.getFormattedDate=function(){let e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0"),n=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0"),s=String(e.getSeconds()).padStart(2,"0");return`${t}_${i}_${o}_${n}_${l}_${s}`},e.prototype.threeDFileLoader=function(){let e=this.getDT(),i=document.createElement("div");i.id="modal",i.className="three-file-modal";let o=document.createElement("div");o.className="three-file-modal-content";let n=document.createElement("span");n.className="three-file-close-button",n.innerHTML="&times;",n.addEventListener("click",()=>{this.removeModal()});let l=t(),s=document.createElement("button");s.type="button",s.id="addFileGroup",s.textContent="add File Group",s.addEventListener("click",()=>{let e=t();o.insertBefore(e,s)});let a=document.createElement("button");a.type="button",a.textContent="UPLOAD",a.addEventListener("click",()=>{let t=[],o=document.querySelectorAll(".three-file-file-group");if(o.forEach((e,i)=>{let o=e.querySelector('input[name="modelFile"]').files,n=e.querySelector('input[name="textureFile"]').files;if(console.log("modelFile: ",o),console.log("textureFile: ",n),o){let l,s=Array.from(o);n.length>0&&(l=Array.from(n)),t.push({model:s,texture:l})}}),t.length>0){t.forEach(t=>{t.model&&t.model.forEach(t=>e.items.add(t)),t.texture&&t.texture.forEach(t=>e.items.add(t))});try{let n=new this.modules({editor:this.element});n.loadFiles(e.files,null,e=>{let i=this.saveCurrentRange();i?this.insert3DModelAtLine(n,e,i,t):this.insert3DModelAtLine(n,e,null,t)})}catch(l){console.error("File Loading Error:",l)}}this.resetDT(),this.removeModal(),i.style.display="none"}),o.appendChild(n),o.appendChild(l),o.appendChild(s),o.appendChild(a),i.appendChild(o),this.element.appendChild(i),this.closeDropDown("Menu-dropdown")},e.prototype.saveCurrentRange=function(){return window.getSelection().rangeCount>0?window.getSelection().getRangeAt(0):null},e.prototype.getModels=function(){if(this.uploadModels.length>0)return this.uploadModels},e.prototype.getFiles=function(){return new Promise(e=>{e(this.uploadFiles)})},e.prototype.getIMGFiles=function(){return new Promise(e=>{e(this.imgUploadFiles)})},e.prototype.getZipFiles=function(){return new Promise(e=>{e(this.zipUploadFiles)})},e.prototype.encodeFileName=function(e){return encodeURIComponent(e)},e.prototype.decodeFileName=function(e){return decodeURIComponent(e)},e.prototype.getThumb=function(){},e.prototype.insert3DModelAtLine=function(e,t,i,o){this.sceneModelSum++,this.threeSceneNum++,this.element;let n=window.getSelection(),l=t.name.split("."),s=l.pop(),a=l.join("."),r=this.containsKoreanOrSpecialChars(a),d=this.getFormattedDate(),p=document.createElement("p");p.title=r?`threeSceneNum${this.threeSceneNum}_${d}`:`threeSceneNum${this.threeSceneNum}_${a}`,p.className=r?`mogl3d_three_scene_${this.threeSceneNum}_${d}`:`mogl3d_three_scene_${this.threeSceneNum}_${a}`,p.classList.add("three-scene");let c={className:p.className,type:"3D",data:o,three:s};this.uploadFiles.push(c),this.uploadModels.push({[p.title]:t});let h;if(1===this.sceneModelSum?(console.log("creating first scene"),h=e.init(p,t)):(console.log("add object to scene"),e.addObject(t)),!this.savedRange&&h)C(n,this.editorName,h);else if(h&&this.savedRange){let u=this.savedRange.startContainer,m=this.savedRange.commonAncestorContainer,f=u.className?u.className:null;if(3===u.nodeType||f)C(n,this.editorName,h);else{let g=document.createElement("br"),y=document.createElement("div");y.appendChild(g);let N=m.parentNode;N.nodeType!==Node.ELEMENT_NODE&&(N=N.parentNode),this.savedRange.deleteContents(),this.savedRange.insertNode(h),this.savedRange.collapse(!1),this.savedRange.insertNode(y),this.savedRange.endContainer.nextSibling?N.insertBefore(y,this.savedRange.endContainer.nextSibling):N.appendChild(y)}}function C(e,t,i){let o=document.querySelector(`.${t}`),n=document.createRange(),l=document.createElement("div");l.textContent="\xa0";let s=document.createElement("div");s.textContent="\xa0",n.selectNodeContents(i),n.collapse(!0),e.removeAllRanges(),e.addRange(n),o.appendChild(i),o.insertBefore(l,i),o.appendChild(s)}},e.prototype.createIMGFileBox=function(e){let t=document.createElement("input");return t.type="file",t.accept=e,t.onchange=e=>{let i=e.target.files[0],o=i.type,n="",l=i.name,s=l.split("."),a=this.encodeFileName(l);s.pop();let r=s.join("."),d=this.containsKoreanOrSpecialChars(r),p=this.getFormattedDate();if(o.startsWith("image/"))n="Image";else{alert("not image file, allow to image file!");return}if(i){this.imgFileNum++;let c=new FileReader;c.onload=e=>{let t=document.createElement("div");t.contentEditable=!1,t.setAttribute("data-filename",a),t.className="mogl3d_img_wrapper",t.style.display="inline-block",t.style.margin="5px";let o=document.createElement("span");o.className=d?`mogl3d_image${this.imgFileNum}_${p}`:`mogl3d_image${this.imgFileNum}_${r}`;let l=document.createElement("img");l.src=e.target.result,o.appendChild(l),t.appendChild(o);let s={className:o.className,type:n,data:i};if(this.uploadFiles.push(s),this.savedRange)console.log("saveRange: ",this.savedRange),this.savedRange.deleteContents(),this.savedRange.insertNode(t),this.savedRange.collapse(!1);else{console.log("No saveRange");let c=document.querySelector(`.${this.editorName}`);c.insertBefore(t,c.firstChild)}let h=document.createRange();h.setStartAfter(o),h.collapse(!0);let u=window.getSelection();u.removeAllRanges(),u.addRange(h)},c.readAsDataURL(i)}t.remove()},t.click(),t},e.prototype.createZipFile=function(){let e=document.createElement("input");return e.type="file",e.accept=".zip",e.onchange=t=>{let i=t.target.files[0];i.type;let o="",n=i.name,l=this.encodeFileName(n),s=n.split("."),a=s.pop(),r=s.join("."),d=this.containsKoreanOrSpecialChars(n);o="zip";let p=this.getFormattedDate();if(i){this.filesNum++;let c=document.createElement("div");c.contentEditable=!1,c.setAttribute("data-filename",l),c.className=d?`mogl3d_zipFile${this.zipFileNum}_${p}`:`mogl3d_zipFile${this.zipFileNum}_${r}`,c.style.display="inline-block",c.style.margin="5px";let h=document.createElement("span");h.textContent=i.name+" ",c.appendChild(h);let u=document.createElement("button");u.textContent="x",u.style.marginLeft="5px",u.onclick=()=>{c.remove()},c.appendChild(u);let m={originalName:n,className:c.className,type:o,data:i,ext:a};if(this.zipUploadFiles.push(m),this.savedRange)this.savedRange.deleteContents(),this.savedRange.insertNode(c);else{let f=document.querySelector(`.${this.editorName}`);f.insertBefore(c,f.firstChild)}e.remove()}},e.click(),e},e.prototype.createModal=function(e){let t;window.getSelection().rangeCount>0&&(t=window.getSelection().getRangeAt(0)),this.closeDropDown("Menu-dropdown");let i=document.createElement("div");i.setAttribute("class","modal"),i.id="videoModal";let o=document.createElement("div");o.setAttribute("class","modal-content"),i.appendChild(o);let n=document.createElement("span");if(n.setAttribute("class","modalClose"),n.id="videoModalClose",n.textContent="\xd7",n.addEventListener("click",e=>{if(this.closeModal(i),t){let o=window.getSelection();o.removeAllRanges(),o.addRange(t)}}),o.appendChild(n),"video"===e){let l=this.videoForm(o,i,t);i.appendChild(l)}return document.body.appendChild(i),i.style.display="block",i.addEventListener("mousedown",function(e){e.stopPropagation()},!0),i},e.prototype.videoForm=function(e,t,i){let o=document.createElement("h2");o.textContent="Add Video";let n=document.createElement("input");n.type="text",n.id="videoUrlInput",n.placeholder="Enter video URL";let l=document.createElement("input");l.type="file",l.id="videoFileInput",l.accept="video/*";let s=document.createElement("button");return s.textContent="Insert Video",s.addEventListener("click",e=>this.insertVideoFromModal(t,i)),e.appendChild(o),e.appendChild(n),e.appendChild(l),e.appendChild(s),e},e.prototype.closeModal=function(e){e.style.display="none",e.remove()},e.prototype.insertVideoFromModal=function(e,t){let i=document.getElementById("videoUrlInput").value,o=document.getElementById("videoFileInput"),n=o.files[0];i?this.insertVideoIframe(i,t):n&&n.size<=31457280?this.insertVideoFile(n):n&&alert("File is too large. Maximum size is 30MB."),this.closeModal(e)},e.prototype.convertToEmbedUrl=function(e){let t=e;if(e.includes("youtube.com/watch?v=")){let i=e.split("v=")[1].split("&")[0];t=`https://www.youtube-nocookie.com/embed/${i}`}else if(e.includes("youtu.be/")){let o=e.split("youtu.be/")[1];t=`https://www.youtube-nocookie.com/embed/${o}`}return t},e.prototype.insertVideoIframe=function(e,t){let i=this.convertToEmbedUrl(e),o=document.querySelector(`.${this.editorName}`),n=document.createTextNode(""),l=document.createElement("span");l.innerHTML=" ",l.appendChild(n);let s=document.createElement("iframe");s.src=i,s.style.width="560px",s.style.height="315px",s.frameBorder="0",s.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",s.allowFullscreen=!0,l.appendChild(s),l.style.whiteSpace="pre",t?(t.deleteContents(),t.insertNode(l)):o.insertBefore(l,o.firstChild)},e.prototype.insertVideoFile=function(e){let t=document.querySelector(`.${this.editorName}`),i=document.createTextNode(""),o=document.createElement("span");o.innerHTML=" ",o.appendChild(i);let n=document.createElement("video");n.controls=!0;let l=document.createElement("source");l.src=URL.createObjectURL(e),l.type=e.type,n.appendChild(l);let s=document.createElement("p");s.contentEditable=!0,s.innerHTML="<br>",o.appendChild(n),o.style.whiteSpace="pre";let a=document.getSelection(),r;return a.rangeCount>0?((r=a.getRangeAt(0)).deleteContents(),r.insertNode(o)):t.insertBefore(o,t.firstChild),t},e.prototype.chkDropID=function(e){return new Promise(t=>{for(let i=0;i<e.childNodes.length;i++)""!==e.childNodes[i].id&&t(e.childNodes[i].id)})},e.prototype.addFonts=function(){var e=document.createElement("link");e.rel="preconnect",e.href="https://fonts.googleapis.com",document.head.appendChild(e);var t=document.createElement("link");t.rel="preconnect",t.href="https://fonts.gstatic.com",t.crossOrigin="anonymous",document.head.appendChild(t);var i=document.createElement("link");i.rel="stylesheet",i.href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Lora:ital,wght@0,400..700;1,400..700&family=Nanum+Gothic&family=Nanum+Myeongjo&family=Noto+Sans+KR:wght@100..900&family=Noto+Serif+KR&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poetsen+One&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Sedan+SC&family=Ubuntu+Sans:ital,wght@0,100..800;1,100..800&display=swap",document.head.appendChild(i)},e.prototype.initFontTypeListener=function(){let e=document.getElementById("mogl3d-fontfamily");e&&(e.removeEventListener("change",this.handleFontTypeChange),this.handleFontTypeChange=t=>{let i=e.value,o=window.getSelection();o.rangeCount&&this.wrapTextWithSpan(o,"fontFamily",i,"font-family")},e.addEventListener("change",this.handleFontTypeChange))},e.prototype.initFontSizeListener=function(){let e=document.getElementById("mogl3d-fontsize");e&&(e.removeEventListener("change",this.handleFontSizeChange),this.handleFontSizeChange=t=>{let i=e.value,o=window.getSelection();o.rangeCount&&this.wrapTextWithSpan(o,"fontSize",i,"font-size")},e.addEventListener("change",this.handleFontSizeChange))},e.prototype.wrapTextWithSpan=function(e,t,i,o){let n=e.getRangeAt(0),l=e.toString().split("\n").length>1;if(!l){let s=n.extractContents(),a=n.commonAncestorContainer,r=this.findParentNode(a,"DIV");"font-size"===o?this.removeChildNode(s,"span","mogl3d-font-span"):this.removeChildNode(s,"span","mogl3d-fontfamily-span");let d=document.createElement("span");d.style[t]=i,d.className="font-size"===o?"mogl3d-font-span":"mogl3d-fontfamily-span",d.appendChild(s),d.normalize(),n.insertNode(d),this.removeEmptyNodes(r)}if(l){let p=n.cloneContents(),c=n.startContainer,h=n.endContainer,u=this.findParentNode(c,"DIV"),m=this.findParentNode(h,"DIV"),f=u.parentNode;n.deleteContents();let g=document.createRange();this.removeEmptyNodes(u),this.removeEmptyNodes(m);let y=p.firstChild,N=p.lastChild;"font-size"===o?(this.removeChildNode(y,"span","mogl3d-font-span"),this.removeChildNode(N,"span","mogl3d-font-span")):"font-family"===o&&(this.removeChildNode(y,"span","mogl3d-fontfamily-span"),this.removeChildNode(N,"span","mogl3d-fontfamily-span"));let C=document.createElement("span");C.className="font-size"===o?"mogl3d-font-span":"mogl3d-fontfamily-span",C.style[t]=i;let v=[],$=p.cloneNode(!0),E=$.childNodes.length-1;Array.from($.childNodes).forEach((e,n)=>{if(0!==n&&n!==E){this.removeEmptyNodes(e),"font-size"===o?this.removeChildNode(e,"span","mogl3d-font-span"):this.removeChildNode(e,"span","mogl3d-fontfamily-span");let l=document.createElement("span");l.className="font-size"===o?"mogl3d-font-span":"mogl3d-fontfamily-span",l.style[t]=i;let s=this.changeNodeToNode(e,l),a=document.createElement("div");a.appendChild(s),v.push(a)}});let S=document.createElement("span");S.className="font-size"===o?"mogl3d-font-span":"mogl3d-fontfamily-span",S.style[t]=i;let w=this.changeNodeToNode(y,C),M=this.changeNodeToNode(N,S);w.normalize(),M.normalize(),u.appendChild(w),m.insertBefore(M,m.firstChild),v.map(e=>{e.normalize(),f.insertBefore(e,m)}),g.setStartBefore(w),g.setEndAfter(M),e.removeAllRanges(),e.addRange(g)}},e.prototype.removeEmptyNodes=function(e){if(e)for(let t=0;t<e.childNodes.length;t++){let i=e.childNodes[t];this.removeEmptyNodes(i),(i.nodeType===Node.ELEMENT_NODE&&""===i.innerHTML||i.nodeType===Node.TEXT_NODE&&""===i.textContent.trim())&&(e.removeChild(i),t--)}},e.prototype.changeNodeToNode=function(e,t){let i=e.cloneNode(!0);for(;i.firstChild;)t.appendChild(i.firstChild);return t},e.prototype.findChildIndex=function(e,t){return Array.prototype.slice.call(e.childNodes).indexOf(t)},e.prototype.extractText=function(e){let t="";return e.nodeType===Node.TEXT_NODE?t+=e.nodeValue:e.nodeType===Node.ELEMENT_NODE&&e.childNodes.forEach(e=>{t+=this.extractText(e)}),t},e.prototype.findParentNode=function(e,t){for(;null!==e&&e.tagName!==t;)e=e.parentNode;return e},e.prototype.removeChildNode=function(e,t,i){let o=i||null,n=e.querySelectorAll(t);n.forEach(e=>{if(e.className===o){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}})},e.prototype.removeNullNode=function(e){Array.from(e.childNodes).forEach(t=>{this.removeNullNode(t),this.isNodeEmpty(t)&&e.removeChild(t)})},e.prototype.isNodeEmpty=function(e){return e.nodeType===Node.ELEMENT_NODE?0===e.childNodes.length||this.areAllChildrenEmpty(e):e.nodeType===Node.TEXT_NODE&&!e.textContent.trim()},e.prototype.areAllChildrenEmpty=function(e){for(let t=0;t<e.childNodes.length;t++)if(!this.isNodeEmpty(e.childNodes[t]))return!1;return!0},e.prototype.removeUpToTagName=function(e,t){let i;for(;e.parentNode&&e.parentNode.nodeName!==t.toUpperCase();)e=e.parentNode;return e.parentNode&&e.parentNode.nodeName===t.toUpperCase()&&(i=e.parentNode,e.parentNode.removeChild(e)),i},e.prototype.removeParentNode=function(e,t){for(;null!==e&&e.tagName!==t;)e=e.parentNode;if(e&&e.tagName===t){let i=e.parentNode;for(console.log("parent: ",i);e.firstChild;)i.insertBefore(e.firstChild,e);i.removeChild(e)}return e},e.prototype.collectNode=function(e,t,i){return e.nodeType===Node.ELEMENT_NODE&&e.tagName===t&&i.push(e),Array.from(e.childNodes).forEach(e=>this.collectNode(e,t,i)),i},e.prototype.cleanNode=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},e.prototype.processFiles=function(e,t){return e.map(e=>new Promise(i=>{let o=t.querySelector(`.${e.className}`);o.parentNode.className=e.className,this.scenes.push(e.className),this.cleanNode(o.parentNode),i({className:e.className,data:e})}))},e.prototype.getDatas=async function(){let e=[],t=document.querySelector(`.${this.editorName}`),i=await this.getFiles(),o=await this.getIMGFiles(),n=await this.getZipFiles();o.length>0&&o.forEach(e=>{t.querySelector(`.${e.className}`).querySelector("img").src=""}),i.length>0&&(await Promise.allSettled(await this.processFiles(i,t))).forEach(t=>{"fulfilled"===t.status&&e.push(t.value.data)});let l=document.createElement("div");return l.innerHTML=t.innerHTML,{code:t=l.innerHTML,files:e,imgFiles:o,zipFiles:n,scenes:this.scenes}},e.prototype.getOutputData=async function(){let e=await this.getDatas();return e||(e=null),e},e});