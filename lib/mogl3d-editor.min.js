!function(e,t){"function"==typeof define&&define.amd?define([],(function(){return t()})):"object"==typeof module&&module.exports?module.exports=t():e.MOGL3D=t()}("undefined"!=typeof self?self:this,(function(){"use strict";function e(e={}){if(this.addFonts(),this.name="MOGL3D Library",this.loader=null,this.modules=null,this.element=e.element,this.editorName=e.editorName,this.content=null,this.options=e,this.savedRange=null,this.threeSceneNum=0,this.imgFileNum=0,this.zipFileNum=0,this.filesNum=0,this.sceneModelSum=0,this.uploadFiles=[],this.uploadModels=[],this.zipUploadFiles=[],this.imgUploadFiles=[],this.scenes=[],this.dt=new DataTransfer,this.options.gui&&(this.height=this.options.gui.height?this.options.gui.height:null),this.options.plugins&&this.options.plugins.length>0){let e=this;this.options.plugins.map((t=>{for(let o in t)"threeModules"===o&&(e.modules=t[o])}))}this.actions=e.actions?e.actions.map((e=>"string"==typeof e?this.defaultActions()[e]:this.defaultActions()[e.name]?{...this.defaultActions()[e.name],...e}:e)):Object.keys(this.defaultActions()).map((e=>this.defaultActions()[e])),this.classes={...this.defaultClasses(this.editorName),...this.options.classes},this.formatBlock="formatBlock",this.defaultParagraphSeparatorString="defaultParagraphSeparator",this.init(),this.initDropdownMenu()}function t(){const e=document.createElement("div");e.className="three-file-file-group";const t=document.createElement("div");t.className="three-file-file-upload";const o=document.createElement("label");o.textContent="3D Model File:";const n=document.createElement("input");n.type="file",n.name="modelFile",n.multiple=!0,n.accept=".obj,.fbx,.gltf,.glb,.bin",t.appendChild(o),t.appendChild(n);const i=document.createElement("div");i.className="three-file-file-upload";const s=document.createElement("label");s.textContent="Texture File:";const l=document.createElement("input");return l.type="file",l.name="textureFile",l.accept=".jpg,.png,.tif,.targa",l.multiple=!0,i.appendChild(s),i.appendChild(l),e.appendChild(t),e.appendChild(i),e}return e.prototype.dropdownActions=function(){return{fontColor:{icon:'<i class="fas fa-highlighter"></i>',result:()=>this.createColorInput("color","foreColor","Menu-dropdown"),title:"Font Color"},fontType:{icon:'\n                    <label for="fontfamily">font family:</label>\n                    <select id="mogl3d-fontfamily">\n                    <option data-type="placeholder" selected> </option>\n                        <option value=\'"Noto Sans KR", sans-serif\'>Nano</option>\n                        <option value=\'"Roboto", sans-serif\'>Roboto</option>\n                        <option value=\'"Poetsen One"\'>Poetsen</option>\n                        <option value=\'"Ubuntu Sans", sans-serif\'>Ubuntu</option>\n                        <option value=\'"Open Sans", sans-serif\'>Open Sans</option>\n                        <option value=\'"Sedan SC", serif\'>Sedan SC</option>\n                        <option value=\'"Lato", sans-serif\'>Lato</option>\n                        <option value=\'"Nanum Myeongjo", serif\'>Nanum Myeongjo</option>\n                        <option value=\'"Noto Serif KR", serif\'>Noto</option>\n                        <option value=\'"Black Han Sans", sans-serif\'>Black Han Sans</option>\n                        <option value=\'"Lora", serif\'>Lora</option>\n                        <option value=\'"Nanum Gothic", sans-serif\'>Nanum Gothic</option>\n                    </select>\n                ',result:()=>{this.initFontTypeListener()},title:"Font Color"},fontSize:{icon:'\n                    <label for="fontsize">size:</label>\n                    <select id="mogl3d-fontsize">\n                        <option data-type="placeholder" selected> </option>\n                        <option value="12px">Small</option>\n                        <option value="16px">Medium</option>\n                        <option value="20px">Large</option>\n                        <option value="24px">Extra Large</option>\n                    </select>\n                ',result:()=>{this.initFontSizeListener()},title:"Font Color"},highlight:{icon:'<i class="fas fa-fill-drip"></i>',result:()=>this.createColorInput("color","backColor","Menu-dropdown"),title:"Highlight Text"},removeHighlight:{icon:'<i class="fas fa-eraser"></i>',result:()=>{this.exec("backColor","transparent"),this.closeDropDown("Menu-dropdown")},title:"Remove Highlight"},leftAlign:{icon:'<i class="fas fa-align-left"></i>',result:()=>{this.exec("justifyLeft"),this.closeDropDown("Menu-dropdown")},title:"LeftAlign"},rightAlign:{icon:'<i class="fas fa-align-right"></i>',result:()=>{this.exec("justifyRight"),this.closeDropDown("Menu-dropdown")},title:"RightAlign"},centerAlign:{icon:'<i class="fas fa-align-center"></i>',result:()=>{this.exec("justifyCenter"),this.closeDropDown("Menu-dropdown")},title:"CenterAlign"},image:{icon:'<i class="fas fa-file-image"></i>',result:()=>{this.createIMGFileBox("image/*"),this.closeDropDown("Menu-dropdown")},title:"Image"},files:{icon:'<i class="fas fa-file-archive"></i>',result:()=>{this.createZipFile(),this.closeDropDown("Menu-dropdown")},title:"files"},load3DModel:{icon:'<i class="fas fa-cube"></i>',result:()=>this.threeDFileLoader(),title:"Load 3D Model"}}},e.prototype.defaultActions=function(){return{italic:{icon:"<i>I</i>",result:()=>this.exec("italic"),state:()=>this.queryCommandState("italic"),title:"Italic"},bold:{icon:"<b>B</b>",result:()=>this.exec("bold"),state:()=>this.queryCommandState("bold"),title:"Bold"},underline:{icon:"<u>U</u>",result:()=>this.exec("underline"),state:()=>this.queryCommandState("underline"),title:"Underline"},strikethrough:{icon:"<strike>S</strike>",result:()=>this.exec("strikeThrough"),state:()=>this.queryCommandState("strikeThrough"),title:"Strike-through"},fontMenu:{icon:'<i class="fas fa-text-height"></i>',result:()=>{},init:e=>{this.initMenu(e,this.editorName,[this.dropdownActions().fontType,this.dropdownActions().fontSize],"FontMenu-dropdown")},title:"FontDropDown"},textColorMenu:{icon:'<i class="fas fa-font"></i>',result:()=>{},init:e=>{this.initMenu(e,this.editorName,[this.dropdownActions().fontColor,this.dropdownActions().highlight,this.dropdownActions().removeHighlight],"TextMenu-dropdown")},title:"TextColorDropDown"},alignMenu:{icon:'<i class="fas fa-align-justify"></i>',result:()=>{},init:e=>{this.initMenu(e,this.editorName,[this.dropdownActions().leftAlign,this.dropdownActions().rightAlign,this.dropdownActions().centerAlign],"AlignMenu-dropdown")},title:"TextAlignDropDown"},line:{icon:"&#8213;",result:()=>this.exec("insertHorizontalRule"),divider:!0,title:"Horizontal Line"},olist:{icon:"&#35;",result:()=>this.exec("insertOrderedList"),title:"Ordered List"},quote:{icon:"&#8220; &#8221;",result:()=>this.exec(this.formatBlock,"<blockquote>"),title:"Quote"},ulist:{icon:"&#8226;",result:()=>this.exec("insertUnorderedList"),title:"Unordered List"},filesMenu:{icon:'<i class="fas fa-upload"></i>',result:()=>{},init:e=>{this.initMenu(e,this.editorName,[this.dropdownActions().image,this.dropdownActions().files,this.dropdownActions().load3DModel],"FileMenu-dropdown")},title:"FilesDropDown"}}},e.prototype.init=function(){const e=this,t=document.createElement("div");t.className=this.classes.actionbar,this.element.appendChild(t),t.style.height=this.height?`${this.height}px`:"720px";const o=document.createElement("div");o.contentEditable=!0,o.className=this.classes.content,o.style.height=this.height?`${this.height}px`:"720px";const n=this.options[this.defaultParagraphSeparatorString]||"div";o.oninput=({target:{firstChild:e}})=>{e&&3===e.nodeType?this.exec("formatBlock",`<${n}>`):"<br>"===o.innerHTML&&(o.innerHTML=""),this.options.onChange&&(this.uploadModels?this.options.onChange(o.innerHTML,this.uploadModels):this.options.onChange(o.innerHTML))},o.onkeydown=e=>{"Enter"===e.key&&"blockquote"===this.queryCommandValue("formatBlock")&&setTimeout((()=>this.exec("formatBlock",`<${n}>`)),0)},o.addEventListener("keyup",(()=>{e.saveSelection()})),o.addEventListener("mouseup",(()=>{e.saveSelection()})),o.addEventListener("focus",(()=>{e.saveSelection()})),this.element.appendChild(o),this.content=o,this.actions.forEach((n=>{const i=document.createElement("button");if(i.className=e.classes.button,i.innerHTML=n.icon,i.setAttribute("type","button"),i.title=n.title,i.addEventListener("click",(e=>{n.result(),o.focus()})),n.state){const t=()=>i.classList[n.state()?"add":"remove"](e.classes.selected);o.addEventListener("keyup",t),o.addEventListener("mouseup",t),i.addEventListener("click",t)}t.appendChild(i)})),this.actions.forEach((e=>{if(e.init){const t=document.querySelector(`button[title="${e.title}"]`);t&&e.init(t)}}))},e.prototype.saveSelection=function(){const e=document.getSelection();e.rangeCount>0&&(this.savedRange=e.getRangeAt(0))},e.prototype.defaultClasses=function(e){return{actionbar:"mogl3d-actionbar",button:"mogl3d-button",content:e,selected:"mogl3d-button-selected"}},e.prototype.exec=function(e,t=null){document.execCommand(e,!1,t)},e.prototype.queryCommandState=function(e){return document.queryCommandState(e)},e.prototype.queryCommandValue=function(e){return document.queryCommandValue(e)},e.prototype.closeDropDown=function(e){document.querySelectorAll(`.${e}`).forEach((e=>{e.style.display="none"}))},e.prototype.createColorInput=function(e,t,o){const n=document.createElement("input"),i=this;n.type=e,n.oninput=e=>{i.exec(t,e.target.value),n.remove()},n.click(),this.closeDropDown(o)},e.prototype.initDropdownMenu=function(){let e=document.querySelectorAll(".dropdown"),t=["TextMenu-dropdown","AlignMenu-dropdown","FileMenu-dropdown","FontMenu-dropdown"];e.forEach((e=>{document.querySelector("#editor");e.addEventListener("click",(async e=>{let o=e.target.parentNode,n="BUTTON"===o.nodeName?o.parentNode:o,i=await this.chkDropID(n);t.forEach((e=>{let t=document.querySelector(`#${e}`);t&&e!==i&&(t.style.display="none")}));let s=document.querySelector(`#${i}`);"flex"===s.style.display?s.style.display="none":s.style.display="flex",e.stopPropagation()}))})),document.addEventListener("click",(e=>{document.querySelector(`.${this.editorName}`);let o=e.target;"mogl3d-fontsize"!==o.id&&"mogl3d-fontfamily"!==o.id&&t.map((e=>{let t=document.querySelector(`#${e}`);t&&"flex"===t.style.display&&(t.style.display="none")}))}))},e.prototype.initMenu=function(e,t,o,n){let i=document.querySelector(`.${t}`),s=this.createDropDownMenu(e,o,i,n);e.parentNode.replaceChild(s,e)},e.prototype.createDropDownMenu=function(e,t,o,n){const i=document.createElement("div");i.className="dropdown";const s=e.cloneNode(!0),l=document.createElement("div");return l.id=n,l.className="Menu-dropdown",Array.from(t).forEach((e=>{const t=document.createElement("button");t.className="mogl3d-button",t.innerHTML=e.icon,t.title=e.title,t.setAttribute("type","button"),t.onclick=()=>e.result()&&o.focus(),l.appendChild(t)})),i.appendChild(s),i.appendChild(l),i},e.prototype.resetDT=function(){console.log("reset DT"),this.sceneModelSum=0,this.dt=null,this.dt=new DataTransfer},e.prototype.getDT=function(){return console.log("get DT"),this.dt?this.dt:new DataTransfer},e.prototype.removeModal=function(){const e=document.getElementById("modal");e&&e.remove()},e.prototype.containsKoreanOrSpecialChars=function(e){return/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(e)||/[~`!@#$%^&*()_\-+={}[\]|\\:;"'<>,.?/]/.test(e)},e.prototype.getFormattedDate=function(){const e=new Date;return`${e.getFullYear()}_${String(e.getMonth()+1).padStart(2,"0")}_${String(e.getDate()).padStart(2,"0")}_${String(e.getHours()).padStart(2,"0")}_${String(e.getMinutes()).padStart(2,"0")}_${String(e.getSeconds()).padStart(2,"0")}`},e.prototype.threeDFileLoader=function(){let e=this.getDT();const o=document.createElement("div");o.id="modal",o.className="three-file-modal";const n=document.createElement("div");n.className="three-file-modal-content";const i=document.createElement("span");i.className="three-file-close-button",i.innerHTML="&times;",i.addEventListener("click",(()=>{this.removeModal()}));const s=t(),l=document.createElement("button");l.type="button",l.id="addFileGroup",l.textContent="add File Group",l.addEventListener("click",(()=>{const e=t();n.insertBefore(e,l)}));const a=document.createElement("button");a.type="button",a.textContent="UPLOAD",a.addEventListener("click",(()=>{let t=[];if(document.querySelectorAll(".three-file-file-group").forEach(((e,o)=>{const n=e.querySelector('input[name="modelFile"]').files,i=e.querySelector('input[name="textureFile"]').files;if(console.log("modelFile: ",n),console.log("textureFile: ",i),n){let e,o=Array.from(n);i.length>0&&(e=Array.from(i)),t.push({model:o,texture:e})}})),t.length>0){t.forEach((t=>{t.model&&t.model.forEach((t=>e.items.add(t))),t.texture&&t.texture.forEach((t=>e.items.add(t)))}));try{let o=null,n=new this.modules({editor:this.element});n.loadFiles(e.files,o,(e=>{const o=this.saveCurrentRange();o?this.insert3DModelAtLine(n,e,o,t):this.insert3DModelAtLine(n,e,null,t)}))}catch(e){console.error("File Loading Error:",e)}}this.resetDT(),this.removeModal(),o.style.display="none"})),n.appendChild(i),n.appendChild(s),n.appendChild(l),n.appendChild(a),o.appendChild(n),this.element.appendChild(o),this.closeDropDown("Menu-dropdown")},e.prototype.saveCurrentRange=function(){return window.getSelection().rangeCount>0?window.getSelection().getRangeAt(0):null},e.prototype.getModels=function(){if(this.uploadModels.length>0)return this.uploadModels},e.prototype.getFiles=function(){return new Promise((e=>{e(this.uploadFiles)}))},e.prototype.getIMGFiles=function(){return new Promise((e=>{e(this.imgUploadFiles)}))},e.prototype.getZipFiles=function(){return new Promise((e=>{e(this.zipUploadFiles)}))},e.prototype.encodeFileName=function(e){return encodeURIComponent(e)},e.prototype.decodeFileName=function(e){return decodeURIComponent(e)},e.prototype.getThumb=function(){},e.prototype.insert3DModelAtLine=function(e,t,o,n){this.sceneModelSum++,this.threeSceneNum++;this.element;const i=window.getSelection();let s=t.name.split("."),l=s.pop(),a=s.join(".");const r=this.containsKoreanOrSpecialChars(a),d=this.getFormattedDate();let c=document.createElement("p");c.title=r?`threeSceneNum${this.threeSceneNum}_${d}`:`threeSceneNum${this.threeSceneNum}_${a}`,c.className=r?`mogl3d_three_scene_${this.threeSceneNum}_${d}`:`mogl3d_three_scene_${this.threeSceneNum}_${a}`;let p,u={className:c.className,type:"3D",data:n,three:l};if(this.uploadFiles.push(u),this.uploadModels.push({[c.title]:t}),1===this.sceneModelSum?(console.log("creating first scene"),p=e.init(c,t)):(console.log("add object to scene"),e.addObject(t)),!this.savedRange&&p){const e=document.querySelector(`.${this.editorName}`),t=document.createRange();let o=document.createElement("div");o.textContent=" ";let n=document.createElement("div");n.textContent=" ",t.selectNodeContents(p),t.collapse(!0),i.removeAllRanges(),i.addRange(t),e.appendChild(p),e.insertBefore(o,p),e.appendChild(n)}else p&&this.savedRange&&(console.log("씬 생성"),this.savedRange.deleteContents(),this.savedRange.insertNode(p))},e.prototype.createIMGFileBox=function(e){const t=document.createElement("input");return t.type="file",t.accept=e,t.onchange=e=>{const o=e.target.files[0],n=o.type;let i="";const s=o.name,l=s.split("."),a=this.encodeFileName(s),r=(l.pop(),l.join(".")),d=this.containsKoreanOrSpecialChars(r),c=this.getFormattedDate();if(n.startsWith("image/")){if(i="Image",o){this.imgFileNum++;const e=new FileReader;e.onload=e=>{const t=document.createElement("div");t.contentEditable=!1,t.setAttribute("data-filename",a),t.className="mogl3d_img_wrapper",t.style.display="inline-block",t.style.margin="5px";const n=document.createElement("span");n.className=d?`mogl3d_image${this.imgFileNum}_${c}`:`mogl3d_image${this.imgFileNum}_${r}`;const s=document.createElement("img");s.src=e.target.result,n.appendChild(s),t.appendChild(n);let l={className:n.className,type:i,data:o};if(this.uploadFiles.push(l),this.savedRange)console.log("saveRange: ",this.savedRange),this.savedRange.deleteContents(),this.savedRange.insertNode(t),this.savedRange.collapse(!1);else{console.log("No saveRange");const e=document.querySelector(`.${this.editorName}`);e.insertBefore(t,e.firstChild)}const p=document.createRange();p.setStartAfter(n),p.collapse(!0);const u=window.getSelection();u.removeAllRanges(),u.addRange(p)},e.readAsDataURL(o)}t.remove()}else alert("not image file, allow to image file!")},t.click(),t},e.prototype.createZipFile=function(){const e=document.createElement("input");return e.type="file",e.accept=".zip",e.onchange=t=>{const o=t.target.files[0];o.type;let n="";const i=o.name,s=this.encodeFileName(i),l=i.split("."),a=l.pop(),r=l.join("."),d=this.containsKoreanOrSpecialChars(i);n="zip";const c=this.getFormattedDate();if(o){this.filesNum++;const t=document.createElement("div");t.contentEditable=!1,t.setAttribute("data-filename",s),t.className=d?`mogl3d_zipFile${this.zipFileNum}_${c}`:`mogl3d_zipFile${this.zipFileNum}_${r}`,t.style.display="inline-block",t.style.margin="5px";const n=document.createElement("span");n.textContent=o.name+" ",t.appendChild(n);const l=document.createElement("button");l.textContent="x",l.style.marginLeft="5px",l.onclick=()=>{t.remove()},t.appendChild(l);let p={originalName:i,className:t.className,type:"zip",data:o,ext:a};if(this.zipUploadFiles.push(p),this.savedRange)this.savedRange.deleteContents(),this.savedRange.insertNode(t);else{const e=document.querySelector(`.${this.editorName}`);e.insertBefore(t,e.firstChild)}e.remove()}},e.click(),e},e.prototype.createModal=function(e){let t;window.getSelection().rangeCount>0&&(t=window.getSelection().getRangeAt(0)),this.closeDropDown("Menu-dropdown");const o=document.createElement("div");o.setAttribute("class","modal"),o.id="videoModal";const n=document.createElement("div");n.setAttribute("class","modal-content"),o.appendChild(n);const i=document.createElement("span");if(i.setAttribute("class","modalClose"),i.id="videoModalClose",i.textContent="×",i.addEventListener("click",(e=>{if(this.closeModal(o),t){const e=window.getSelection();e.removeAllRanges(),e.addRange(t)}})),n.appendChild(i),"video"===e){let e=this.videoForm(n,o,t);o.appendChild(e)}return document.body.appendChild(o),o.style.display="block",o.addEventListener("mousedown",(function(e){e.stopPropagation()}),!0),o},e.prototype.videoForm=function(e,t,o){const n=document.createElement("h2");n.textContent="Add Video";const i=document.createElement("input");i.type="text",i.id="videoUrlInput",i.placeholder="Enter video URL";const s=document.createElement("input");s.type="file",s.id="videoFileInput",s.accept="video/*";const l=document.createElement("button");return l.textContent="Insert Video",l.addEventListener("click",(e=>this.insertVideoFromModal(t,o))),e.appendChild(n),e.appendChild(i),e.appendChild(s),e.appendChild(l),e},e.prototype.closeModal=function(e){e.style.display="none",e.remove()},e.prototype.insertVideoFromModal=function(e,t){const o=this,n=document.getElementById("videoUrlInput").value,i=document.getElementById("videoFileInput").files[0];n?o.insertVideoIframe(n,t):i&&i.size<=31457280?o.insertVideoFile(i):i&&alert("File is too large. Maximum size is 30MB."),this.closeModal(e)},e.prototype.convertToEmbedUrl=function(e){let t=e;if(e.includes("youtube.com/watch?v=")){t=`https://www.youtube-nocookie.com/embed/${e.split("v=")[1].split("&")[0]}`}else if(e.includes("youtu.be/")){t=`https://www.youtube-nocookie.com/embed/${e.split("youtu.be/")[1]}`}return t},e.prototype.insertVideoIframe=function(e,t){let o=this.convertToEmbedUrl(e);const n=document.querySelector(`.${this.editorName}`);let i=document.createTextNode("");const s=document.createElement("span");s.innerHTML=" ",s.appendChild(i);const l=document.createElement("iframe");l.src=o,l.style.width="560px",l.style.height="315px",l.frameBorder="0",l.allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture",l.allowFullscreen=!0,s.appendChild(l),s.style.whiteSpace="pre",t?(t.deleteContents(),t.insertNode(s)):n.insertBefore(s,n.firstChild)},e.prototype.insertVideoFile=function(e){const t=document.querySelector(`.${this.editorName}`);let o=document.createTextNode("");const n=document.createElement("span");n.innerHTML=" ",n.appendChild(o);const i=document.createElement("video");i.controls=!0;const s=document.createElement("source");s.src=URL.createObjectURL(e),s.type=e.type,i.appendChild(s);const l=document.createElement("p");l.contentEditable=!0,l.innerHTML="<br>",n.appendChild(i),n.style.whiteSpace="pre";const a=document.getSelection();let r;return a.rangeCount>0?(r=a.getRangeAt(0),r.deleteContents(),r.insertNode(n)):t.insertBefore(n,t.firstChild),t},e.prototype.chkDropID=function(e){return new Promise((t=>{for(let o=0;o<e.childNodes.length;o++)""!==e.childNodes[o].id&&t(e.childNodes[o].id)}))},e.prototype.addFonts=function(){var e=document.createElement("link");e.rel="preconnect",e.href="https://fonts.googleapis.com",document.head.appendChild(e);var t=document.createElement("link");t.rel="preconnect",t.href="https://fonts.gstatic.com",t.crossOrigin="anonymous",document.head.appendChild(t);var o=document.createElement("link");o.rel="stylesheet",o.href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Lora:ital,wght@0,400..700;1,400..700&family=Nanum+Gothic&family=Nanum+Myeongjo&family=Noto+Sans+KR:wght@100..900&family=Noto+Serif+KR&family=Open+Sans:ital,wght@0,300..800;1,300..800&family=Poetsen+One&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Sedan+SC&family=Ubuntu+Sans:ital,wght@0,100..800;1,100..800&display=swap",document.head.appendChild(o)},e.prototype.initFontTypeListener=function(){const e=document.getElementById("mogl3d-fontfamily");e&&(e.removeEventListener("change",this.handleFontTypeChange),this.handleFontTypeChange=t=>{const o=e.value,n=window.getSelection();n.rangeCount&&this.wrapTextWithSpan(n,"fontFamily",o,"font-family")},e.addEventListener("change",this.handleFontTypeChange))},e.prototype.initFontSizeListener=function(){const e=document.getElementById("mogl3d-fontsize");e&&(e.removeEventListener("change",this.handleFontSizeChange),this.handleFontSizeChange=t=>{const o=e.value,n=window.getSelection();n.rangeCount&&this.wrapTextWithSpan(n,"fontSize",o,"font-size")},e.addEventListener("change",this.handleFontSizeChange))},e.prototype.wrapTextWithSpan=function(e,t,o,n){let i=e.getRangeAt(0);const s=e.toString().split("\n").length>1;if(!s){let e=i.extractContents(),s=i.commonAncestorContainer,l=this.findParentNode(s,"DIV");"font-size"===n?this.removeChildNode(e,"span","mogl3d-font-span"):this.removeChildNode(e,"span","mogl3d-fontfamily-span");let a=document.createElement("span");a.style[t]=o,a.className="font-size"===n?"mogl3d-font-span":"mogl3d-fontfamily-span",a.appendChild(e),a.normalize(),i.insertNode(a),this.removeEmptyNodes(l)}if(s){let s=i.cloneContents(),l=i.startContainer,a=i.endContainer,r=this.findParentNode(l,"DIV"),d=this.findParentNode(a,"DIV"),c=r.parentNode;i.deleteContents();let p=document.createRange();this.removeEmptyNodes(r),this.removeEmptyNodes(d);let u=s.firstChild,h=s.lastChild;"font-size"===n?(this.removeChildNode(u,"span","mogl3d-font-span"),this.removeChildNode(h,"span","mogl3d-font-span")):"font-family"===n&&(this.removeChildNode(u,"span","mogl3d-fontfamily-span"),this.removeChildNode(h,"span","mogl3d-fontfamily-span"));let m=document.createElement("span");m.className="font-size"===n?"mogl3d-font-span":"mogl3d-fontfamily-span",m.style[t]=o;let f=[],g=s.cloneNode(!0),y=g.childNodes.length-1;Array.from(g.childNodes).forEach(((e,i)=>{if(0!==i&&i!==y){this.removeEmptyNodes(e),"font-size"===n?this.removeChildNode(e,"span","mogl3d-font-span"):this.removeChildNode(e,"span","mogl3d-fontfamily-span");let i=document.createElement("span");i.className="font-size"===n?"mogl3d-font-span":"mogl3d-fontfamily-span",i.style[t]=o;let s=this.changeNodeToNode(e,i),l=document.createElement("div");l.appendChild(s),f.push(l)}}));let N=document.createElement("span");N.className="font-size"===n?"mogl3d-font-span":"mogl3d-fontfamily-span",N.style[t]=o;let C=this.changeNodeToNode(u,m),v=this.changeNodeToNode(h,N);C.normalize(),v.normalize(),r.appendChild(C),d.insertBefore(v,d.firstChild),f.map((e=>{e.normalize(),c.insertBefore(e,d)})),p.setStartBefore(C),p.setEndAfter(v),e.removeAllRanges(),e.addRange(p)}},e.prototype.removeEmptyNodes=function(e){if(e)for(let t=0;t<e.childNodes.length;t++){const o=e.childNodes[t];this.removeEmptyNodes(o),(o.nodeType===Node.ELEMENT_NODE&&""===o.innerHTML||o.nodeType===Node.TEXT_NODE&&""===o.textContent.trim())&&(e.removeChild(o),t--)}},e.prototype.changeNodeToNode=function(e,t){let o=e.cloneNode(!0);for(;o.firstChild;)t.appendChild(o.firstChild);return t},e.prototype.findChildIndex=function(e,t){return Array.prototype.slice.call(e.childNodes).indexOf(t)},e.prototype.extractText=function(e){let t="";return e.nodeType===Node.TEXT_NODE?t+=e.nodeValue:e.nodeType===Node.ELEMENT_NODE&&e.childNodes.forEach((e=>{t+=this.extractText(e)})),t},e.prototype.findParentNode=function(e,t){for(;null!==e&&e.tagName!==t;)e=e.parentNode;return e},e.prototype.removeChildNode=function(e,t,o){let n=o||null;e.querySelectorAll(t).forEach((e=>{if(e.className===n){for(;e.firstChild;)e.parentNode.insertBefore(e.firstChild,e);e.parentNode.removeChild(e)}}))},e.prototype.removeNullNode=function(e){Array.from(e.childNodes).forEach((t=>{this.removeNullNode(t),this.isNodeEmpty(t)&&e.removeChild(t)}))},e.prototype.isNodeEmpty=function(e){return e.nodeType===Node.ELEMENT_NODE?0===e.childNodes.length||this.areAllChildrenEmpty(e):e.nodeType===Node.TEXT_NODE&&!e.textContent.trim()},e.prototype.areAllChildrenEmpty=function(e){for(let t=0;t<e.childNodes.length;t++)if(!this.isNodeEmpty(e.childNodes[t]))return!1;return!0},e.prototype.removeUpToTagName=function(e,t){let o;for(;e.parentNode&&e.parentNode.nodeName!==t.toUpperCase();)e=e.parentNode;return e.parentNode&&e.parentNode.nodeName===t.toUpperCase()&&(o=e.parentNode,e.parentNode.removeChild(e)),o},e.prototype.removeParentNode=function(e,t){for(;null!==e&&e.tagName!==t;)e=e.parentNode;if(e&&e.tagName===t){const t=e.parentNode;for(console.log("parent: ",t);e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}return e},e.prototype.collectNode=function(e,t,o){return e.nodeType===Node.ELEMENT_NODE&&e.tagName===t&&o.push(e),Array.from(e.childNodes).forEach((e=>this.collectNode(e,t,o))),o},e.prototype.cleanNode=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},e.prototype.processFiles=function(e,t){return e.map((e=>new Promise((o=>{let n=t.querySelector(`.${e.className}`);n.parentNode.className=e.className,this.scenes.push(e.className),this.cleanNode(n.parentNode),o({className:e.className,data:e})}))))},e.prototype.getDatas=async function(){let e=[],t=document.querySelector(`.${this.editorName}`),o=await this.getFiles(),n=await this.getIMGFiles(),i=await this.getZipFiles();if(n.length>0&&n.forEach((e=>{t.querySelector(`.${e.className}`).querySelector("img").src=""})),o.length>0){let n=await this.processFiles(o,t);(await Promise.allSettled(n)).forEach((t=>{"fulfilled"===t.status&&e.push(t.value.data)}))}let s=document.createElement("div");return s.innerHTML=t.innerHTML,t=s.innerHTML,{code:t,files:e,imgFiles:n,zipFiles:i,scenes:this.scenes}},e.prototype.getOutputData=async function(){let e=await this.getDatas();return e||(e=null),e},e}));